
(*************************************************************)
(*      This file is distributed under the terms of the      *)
(*      GNU Lesser General Public License Version 2.1        *)
(*************************************************************)
(*    Benjamin.Gregoire@inria.fr Laurent.Thery@inria.fr      *)
(*************************************************************)

Set Implicit Arguments.

Require Import Lucas ZArith Znumtheory.
Open Scope Z_scope. 

Eval vm_compute in lucas 17.

Eval vm_compute in lucas_step 17 4 5.

Ltac vmtac :=
match goal with |- _ = ?x =>
vm_cast_no_check  (refl_equal x)
end.

Lemma P1 : lucas_step 17 4 5 = 119121.
Proof.
vmtac.
Qed. 

Eval vm_compute in lucas_step 17 119121 5.

Lemma P2 : lucas_step 17 119121  5 = 70490.
Proof.
vmtac.
Qed.

Eval vm_compute in lucas_step 17 70490  5.

Lemma P3 : lucas_step 17 70490  5 = 0.
Proof.
vmtac.
Qed.
 
Lemma P4 : 2 < 17.
Proof.
auto.
Qed.

Lemma P5 p : 2 < Zpos p -> 0 <= 4 < 2 ^ (Zpos p) - 1.
Proof.
intros H; split; auto with zarith.
assert (8 <= 2 ^Zpos p); auto with zarith.
replace 8 with (2 ^ 3); auto with zarith.
apply Zpow_facts.Zpower_le_monotone; auto with zarith.
Qed.

Theorem prime17 : prime (2 ^ 17 - 1).
apply lucas_prime.
exact P4.
apply lucasE.
exact P4.
assert (F := lucas_step_add _ _ P4 (P5 P4) P1 P2).
exact (lucas_step_add _ _ P4 (P5 P4) F P3).
Qed.

Print prime17.

Lemma R1 : 
 lucas_step 4423 4 2000 = 247077759786888067280809155948454313798037352805637384486263637222554658239161353255447456254436524350964833464298759447980951639886665190067468104497345992510316731796186418462059190182029200941676329310897642294883079136574222698236597847339947509172370118686624176192645830733327110837068732883536661150405791145458863391273095645499575178336847632698037735450979436910261982453711157585736875313551148883437175859517858683694372431508898851341046854946985069407513586422873322505271859187691653161400997365636682896412306834524098766202647414838446052273061532823872918320905808941854441199310769049817220058321039414252582115440999041948081428330842839944425674261760653597729236953316091059793770166262724571599852860713922827771446507607689368560446740144586258420624690864129993582545903441398509503418173361669039094149025615546776446913958622494726165774059184983393706589989459158387978039330537416078014774915551837794429965344131173920586221988710611537541675014448567197358961067082244484557798303875021608231404710694410188672785623857296397225376403983543003653204076025161475411331445475304651129941918244462866157325130760441136948960161340913968081867062655521877291459546816344298791781564263204258562574838727687380935849357907546444629251146035269614523837653320439620788394173252858176187656433591723860896382.
Proof.
vmtac.
Qed. 

Lemma R2 : 
lucas_step 4423
247077759786888067280809155948454313798037352805637384486263637222554658239161353255447456254436524350964833464298759447980951639886665190067468104497345992510316731796186418462059190182029200941676329310897642294883079136574222698236597847339947509172370118686624176192645830733327110837068732883536661150405791145458863391273095645499575178336847632698037735450979436910261982453711157585736875313551148883437175859517858683694372431508898851341046854946985069407513586422873322505271859187691653161400997365636682896412306834524098766202647414838446052273061532823872918320905808941854441199310769049817220058321039414252582115440999041948081428330842839944425674261760653597729236953316091059793770166262724571599852860713922827771446507607689368560446740144586258420624690864129993582545903441398509503418173361669039094149025615546776446913958622494726165774059184983393706589989459158387978039330537416078014774915551837794429965344131173920586221988710611537541675014448567197358961067082244484557798303875021608231404710694410188672785623857296397225376403983543003653204076025161475411331445475304651129941918244462866157325130760441136948960161340913968081867062655521877291459546816344298791781564263204258562574838727687380935849357907546444629251146035269614523837653320439620788394173252858176187656433591723860896382
2000 =
193291173208795510210299556210933638961738599343244020903852169260385671693664532408231232402452745614019259856205537929688882776639566854118743374056182043519003369480951813675009134042190196463941167744876739003827412754958635375777938955019365410451067299148413106305006890956090261599181549361195895697383389399060559329135061550816640315184964807187528174790515497323045418098739251625737565721594024714412855885124830967286498386850126873632222552942754949858966159808028136429943158460915793878698037093516384065738945711403878090390322387486576395596459643077537010322203025315220804723773120698357874414954683459206088666246525174962958049126700167909281458352326811537283266615615183693960924600944072736254785838599180257839399785604957223605534727837911969344743901468801372741975306622969502703867094423712426473726482523758259528145977252531159780950731308912089753673431855849699815901267176708111635093746346026077015927858754950395298841434091641792615767779502646581111068738385908781342615440064709514358687855200442310225025459616226945301394370041384399420357504662647889112753836043824328700992815496653013574373939725735169116086188854877983807516949765787409734551857138239956047852509915056864561050392485936340629394966785400578185064369368082119980160105069430413483332293732329456924894140724165558796253
.
Proof.
vmtac.
Qed.

Lemma R3 :
lucas_step 4423 
193291173208795510210299556210933638961738599343244020903852169260385671693664532408231232402452745614019259856205537929688882776639566854118743374056182043519003369480951813675009134042190196463941167744876739003827412754958635375777938955019365410451067299148413106305006890956090261599181549361195895697383389399060559329135061550816640315184964807187528174790515497323045418098739251625737565721594024714412855885124830967286498386850126873632222552942754949858966159808028136429943158460915793878698037093516384065738945711403878090390322387486576395596459643077537010322203025315220804723773120698357874414954683459206088666246525174962958049126700167909281458352326811537283266615615183693960924600944072736254785838599180257839399785604957223605534727837911969344743901468801372741975306622969502703867094423712426473726482523758259528145977252531159780950731308912089753673431855849699815901267176708111635093746346026077015927858754950395298841434091641792615767779502646581111068738385908781342615440064709514358687855200442310225025459616226945301394370041384399420357504662647889112753836043824328700992815496653013574373939725735169116086188854877983807516949765787409734551857138239956047852509915056864561050392485936340629394966785400578185064369368082119980160105069430413483332293732329456924894140724165558796253
421 = 0.
Proof.
vmtac.
Qed.
 

Lemma R4 : 2 < 4423.
Proof.
red.
vmtac.
Qed.


Theorem prime4423 : prime (2 ^ 4423 - 1).
Proof.
assert (decomp :  (421 + (2000 + 2000))%positive = (4423 - 2)%positive).
vmtac.
apply lucas_prime.
exact R4.
apply lucasE.
exact R4.
apply (lucas_step_same_p _ _ decomp).
pose (F := lucas_step_add _ _ R4 (P5 R4) R1 R2).
exact (lucas_step_add _ _ R4 (P5 R4) F R3).
Time Qed.

Lemma FF : lucas_step 4423 4 1105 = 240132664833516173135764083729488268930697533447958870463602077222080351693751902580069003182625907019033394909833214327842221320606710501518462613943560587183333116643513214904302393102768599093880747132911716430006139910764865254183663418209419386830877006903296052553330796702701079453120535945605397525296205811441959684203865435924710455854505614084008952471005012704218098878770945229863070891940179981246429453772995257019350224214504614160545452649593640775331915463022347549546899645930267509558604812116524978474443582662403132092620938787323153218650655618626981296042765201433931693781115218567152201122515583748494871449802219417257693109112990692308688509884524308450331443406305504582207923570714784685925281959611127228435821040511556276441870315805129890640507536957124461553439067848334164053291053619695045119489635607390453532165425933940270969038807556445844288448752195959959199941558337878841253272224908299514671079655093400040834078032624387614962642967821254020580530575797110668670455064615662130133032320978008400859119917820106401033907120348982941727375332912956262495376284364079694131318464997409539724498434780280380800323050885471888413790899111924610693729002738866068372846331399764108940135483127112780039310833831155561881379627168674967098965260079529886321284809592360379944796687372075433291.
vmtac.
Qed.

Lemma lucastest_0 : lucas_step 4423 4 1105 = 240132664833516173135764083729488268930697533447958870463602077222080351693751902580069003182625907019033394909833214327842221320606710501518462613943560587183333116643513214904302393102768599093880747132911716430006139910764865254183663418209419386830877006903296052553330796702701079453120535945605397525296205811441959684203865435924710455854505614084008952471005012704218098878770945229863070891940179981246429453772995257019350224214504614160545452649593640775331915463022347549546899645930267509558604812116524978474443582662403132092620938787323153218650655618626981296042765201433931693781115218567152201122515583748494871449802219417257693109112990692308688509884524308450331443406305504582207923570714784685925281959611127228435821040511556276441870315805129890640507536957124461553439067848334164053291053619695045119489635607390453532165425933940270969038807556445844288448752195959959199941558337878841253272224908299514671079655093400040834078032624387614962642967821254020580530575797110668670455064615662130133032320978008400859119917820106401033907120348982941727375332912956262495376284364079694131318464997409539724498434780280380800323050885471888413790899111924610693729002738866068372846331399764108940135483127112780039310833831155561881379627168674967098965260079529886321284809592360379944796687372075433291.
Proof. vmtac. Qed.
Lemma lucastest_1 : lucas_step 4423 240132664833516173135764083729488268930697533447958870463602077222080351693751902580069003182625907019033394909833214327842221320606710501518462613943560587183333116643513214904302393102768599093880747132911716430006139910764865254183663418209419386830877006903296052553330796702701079453120535945605397525296205811441959684203865435924710455854505614084008952471005012704218098878770945229863070891940179981246429453772995257019350224214504614160545452649593640775331915463022347549546899645930267509558604812116524978474443582662403132092620938787323153218650655618626981296042765201433931693781115218567152201122515583748494871449802219417257693109112990692308688509884524308450331443406305504582207923570714784685925281959611127228435821040511556276441870315805129890640507536957124461553439067848334164053291053619695045119489635607390453532165425933940270969038807556445844288448752195959959199941558337878841253272224908299514671079655093400040834078032624387614962642967821254020580530575797110668670455064615662130133032320978008400859119917820106401033907120348982941727375332912956262495376284364079694131318464997409539724498434780280380800323050885471888413790899111924610693729002738866068372846331399764108940135483127112780039310833831155561881379627168674967098965260079529886321284809592360379944796687372075433291 1105 = 97292374306581273010411645862638942506944670538370876714146554832881158246634575371331009773898490554142823762792901952789839023946600212267569296490494074804558080094489942621011283129449639195742929239312619397587829656668418657552120202722915492047561959198497414759261826590911941467685685336598106515448194717751238983347176175723491691403371120104215618628120003016860389008570746940407734027220411034110028115656428225601441015208931166922052813423622096924059924106064548734366478522661665814933857422528284446013470275872062064607141223515754174263298493644792260780523755729112968087256542027657596840903268724164526170713649969201494604160435698687218748187029897335866612394331974628478901963164178363868676805575262282571285428192825509893370157965759401230224342625135438393447473297015966066147461893369161946690406054846917341357386825428663370432471219198885811775294882426800335726648962034562755162651443328035064650594085029845268084567111916426819542214131063662531462790298467475025872858851403785425238289525547587037841027120138100560810772966840229942349283423346583583813691707069698112261947993097469181277837605769586201580687226505493657245624328915712982510976996915910652904260890866608088208514111529232639428131713129027267328199294338446709428330893102151643847914868667944268001469669342027382817.
Proof. vmtac. Qed.
Lemma lucastest_2 : lucas_step 4423 97292374306581273010411645862638942506944670538370876714146554832881158246634575371331009773898490554142823762792901952789839023946600212267569296490494074804558080094489942621011283129449639195742929239312619397587829656668418657552120202722915492047561959198497414759261826590911941467685685336598106515448194717751238983347176175723491691403371120104215618628120003016860389008570746940407734027220411034110028115656428225601441015208931166922052813423622096924059924106064548734366478522661665814933857422528284446013470275872062064607141223515754174263298493644792260780523755729112968087256542027657596840903268724164526170713649969201494604160435698687218748187029897335866612394331974628478901963164178363868676805575262282571285428192825509893370157965759401230224342625135438393447473297015966066147461893369161946690406054846917341357386825428663370432471219198885811775294882426800335726648962034562755162651443328035064650594085029845268084567111916426819542214131063662531462790298467475025872858851403785425238289525547587037841027120138100560810772966840229942349283423346583583813691707069698112261947993097469181277837605769586201580687226505493657245624328915712982510976996915910652904260890866608088208514111529232639428131713129027267328199294338446709428330893102151643847914868667944268001469669342027382817 1105 = 188485118747687352860073079915841797388310978464614698259239528925713251476292334071512310724638311649256632405954493147318228369261266844942170377957948913460032409223381855482528686605578861027224134942821374007499574556297950485806378397515575984873033862625877744003728566672473412345053278964249086496097503964410903086901902509525484244618592783845594675635372675652845390805626616128522958494108729659901104028862237760031773626307612252003825624605414175030747753847376062747901909548565769436210797727851548022569231862706567587055377891226568529895628342519434504231091897144757906250715809135500204707926907613322298299781708016739034411483131977198488799214500602165894133576477612889683622714779964779753112499928581152026442176392221306281963561352663735278652440414460030586447453245247535091861294169533437115294451572941301947260612516681821060924713854667199837394073572740583799976995697921705986242609795545506855765707747319275089838460853230219435436335399455837048225773852222047674111587243967120539939311324438326847436429200948140785492662712446739327188087347767224222979949467548460370989144533554563436464774659405032266701559488732895137435602726337528312489709247803175818784719198067628716081122719677053182137096450038347946142935561355815030154992735253924615783292214033225554879676194589444662056.
Proof. vmtac. Qed.
Lemma lucastest_3 : lucas_step 4423 188485118747687352860073079915841797388310978464614698259239528925713251476292334071512310724638311649256632405954493147318228369261266844942170377957948913460032409223381855482528686605578861027224134942821374007499574556297950485806378397515575984873033862625877744003728566672473412345053278964249086496097503964410903086901902509525484244618592783845594675635372675652845390805626616128522958494108729659901104028862237760031773626307612252003825624605414175030747753847376062747901909548565769436210797727851548022569231862706567587055377891226568529895628342519434504231091897144757906250715809135500204707926907613322298299781708016739034411483131977198488799214500602165894133576477612889683622714779964779753112499928581152026442176392221306281963561352663735278652440414460030586447453245247535091861294169533437115294451572941301947260612516681821060924713854667199837394073572740583799976995697921705986242609795545506855765707747319275089838460853230219435436335399455837048225773852222047674111587243967120539939311324438326847436429200948140785492662712446739327188087347767224222979949467548460370989144533554563436464774659405032266701559488732895137435602726337528312489709247803175818784719198067628716081122719677053182137096450038347946142935561355815030154992735253924615783292214033225554879676194589444662056 1105 = 285542542228279613901563566102164008326164238644702889199247456602284400390600653875954571505539843239754513915896150297878399377056071435169747221107988791198200988477531339214282772016059009904586686254989084815735422480409022344297588352526004383890632616124076317387416881148592486188361873904175783145696016919574390765598280188599035578448591077683677175520434074287726578006266759615970759521327828555662781678385691581844436444812511562428136742490459363212810180276096088111401003377570363545725120924073646921576797146199387619296560302680261790118132925012323046444438622308877924609373773012481681672424493674474488537770155783006880852648161513067144814034586650074401976911197180945587925657453229964418246026231923426296627065219309344461248503768803513613102228207183983132895371386683206886264578262043317658912355208412488648261356160186617986520752930901863708272492067051453169595261467276768013926241736051792947424014434100492358789159764242973820941729540083418499425185661909178603495798770985156297923350806094023908530178706722935651660043035488944120124885990596310275065162408889764820228653190120030714285669460250028089653684411511505528430753342648536027835593777100310196184239921861342779816571789868111252857029549569939150836370022877998786983519407795336979817994007464303071095448242313349824511.
Proof. vmtac. Qed.
Lemma lucastest_4 : lucas_step 4423 285542542228279613901563566102164008326164238644702889199247456602284400390600653875954571505539843239754513915896150297878399377056071435169747221107988791198200988477531339214282772016059009904586686254989084815735422480409022344297588352526004383890632616124076317387416881148592486188361873904175783145696016919574390765598280188599035578448591077683677175520434074287726578006266759615970759521327828555662781678385691581844436444812511562428136742490459363212810180276096088111401003377570363545725120924073646921576797146199387619296560302680261790118132925012323046444438622308877924609373773012481681672424493674474488537770155783006880852648161513067144814034586650074401976911197180945587925657453229964418246026231923426296627065219309344461248503768803513613102228207183983132895371386683206886264578262043317658912355208412488648261356160186617986520752930901863708272492067051453169595261467276768013926241736051792947424014434100492358789159764242973820941729540083418499425185661909178603495798770985156297923350806094023908530178706722935651660043035488944120124885990596310275065162408889764820228653190120030714285669460250028089653684411511505528430753342648536027835593777100310196184239921861342779816571789868111252857029549569939150836370022877998786983519407795336979817994007464303071095448242313349824511 1 = 0.
Proof. vmtac. Qed.





